# Project Structure

## Root Directory Organization

### Core Service Files
- `*_server.py`: Main service implementations (e.g., `whisperhallu_server.py`, `video2x_server.py`)
- `*_server_modal.py`: Modal.com deployment variants
- `start_*.sh`: Service management scripts with start/stop/restart functionality

### Supporting Modules
- `transcribeHallu.py`: Core transcription logic
- `demucsWrapper.py`: Audio separation wrapper
- `json_util.py`: JSON processing utilities
- `lang2to3.py`: Language code conversion utilities

### Test Files
- `*_test.py`: Unit tests (e.g., `json_util_test.py`)
- `test_*.py`: Integration tests (e.g., `test_transcribe_hallu.py`)

### Configuration
- `.env`: Environment variables (API keys, secrets)
- `requirements.txt`: Python dependencies
- `README.md`: Comprehensive setup and usage documentation

## Directory Structure

### `/input`
- Audio and video files for processing
- Test media files (`.mp3`, `.mp4`, `.webm`)

### `/output` 
- Processed media files output directory
- Generated by services during processing

### `/logs`
- Service-specific logs: `{service_name}_YYYYMMDD.log`
- Process logs: `nohup.YYYYMMDD.out`
- Cron logs: `cron_cleanup.log`

### `/markers`
- Audio marker files for different languages
- Format: `{type}-MRK-{lang}.wav` (e.g., `OKW-MRK-en.wav`)

### `/whisper-*-ct2`
- Pre-trained Whisper model files
- Contains `config.json`, `model.bin`, `vocabulary.json`

### `/prodenv`
- Python virtual environment for production
- Isolated dependency management

## Naming Conventions

### Services
- Pattern: `{service_name}_server.py`
- Examples: `whisperhallu_server.py`, `video2x_server.py`

### Management Scripts  
- Pattern: `start_{service_name}.sh`
- Examples: `start_whisperhallu.sh`, `start_video2x_server.sh`

### Log Files
- Service logs: `{service_name}_YYYYMMDD.log`
- Process logs: `nohup.YYYYMMDD.out`
- Specific logs: `{service_name}.YYYYMMDD.out`

### Test Files
- Unit tests: `{module_name}_test.py`
- Integration tests: `test_{functionality}.py`

## Architecture Patterns

### LitServe API Structure
All services follow the LitServe pattern:
```python
class ServiceAPI(ls.LitAPI):
    def setup(self, device):
        # Initialize models and resources
        
    def decode_request(self, request):
        # Parse incoming request
        
    def predict(self, inputs):
        # Core processing logic
        
    def encode_response(self, output):
        # Format response
```

### Service Management
- Each service has a dedicated shell script for lifecycle management
- PID files stored in `/tmp/{service_name}.pid`
- Logs automatically rotated with date stamps
- Environment variables loaded from `.env`

### Error Handling
- Comprehensive logging with timestamps and context
- Graceful error responses via HTTP status codes
- Process cleanup on service shutdown